global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "/etc/prometheus/rules/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # Security Metrics from Applications
  - job_name: 'security-metrics'
    static_configs:
      - targets:
        - 'app:3000'
        - 'api-gateway:3001'
        - 'enterprise-api:3002'
        - 'labeling-backend:3003'
        - 'payment-backend:3004'
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s

  # Rate Limiting Metrics
  - job_name: 'rate-limiting'
    static_configs:
      - targets:
        - 'rate-limiter:8080'
    metrics_path: '/stats'
    scrape_interval: 5s
    scrape_timeout: 3s

  # Infrastructure Security Metrics
  - job_name: 'infrastructure-security'
    static_configs:
      - targets:
        - 'security-metrics:8081'
    metrics_path: '/security-metrics'
    scrape_interval: 30s
    scrape_timeout: 10s

  # Container Security Metrics
  - job_name: 'container-security'
    static_configs:
      - targets:
        - 'cadvisor:8080'
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s

  # Fail2Ban Metrics
  - job_name: 'fail2ban'
    static_configs:
      - targets:
        - 'fail2ban-exporter:9191'
    scrape_interval: 30s
    scrape_timeout: 5s

  # Node Exporter for System Metrics
  - job_name: 'node-exporter'
    static_configs:
      - targets:
        - 'node-exporter:9100'
    scrape_interval: 15s
    scrape_timeout: 10s

  # Custom Security Endpoints
  - job_name: 'security-endpoints'
    static_configs:
      - targets:
        - 'api-gateway:3001'
        - 'enterprise-api:3002'
    metrics_path: '/security-metrics'
    scrape_interval: 30s
    scrape_timeout: 10s

  # SSL Certificate Monitoring
  - job_name: 'ssl-certificates'
    static_configs:
      - targets:
        - 'labelmint.it:443'
        - 'api.labelmint.it:443'
        - 'app.labelmint.it:443'
        - 'enterprise-api.labelmint.it:443'
    metrics_path: '/probe'
    params:
      module: [http_2xx]
    scrape_interval: 300s
    scrape_timeout: 10s

  # DNS Security Monitoring
  - job_name: 'dns-security'
    static_configs:
      - targets:
        - '9.9.9.9:53'  # Public DNS servers
        - '8.8.8.8:53'
    metrics_path: '/dns_probe'
    scrape_interval: 300s
    scrape_timeout: 10s